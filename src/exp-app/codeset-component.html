<!DOCTYPE html>
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../my-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-data-table/iron-data-table.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="./codeset-component-edit.html">

<script src="./serviceInterface.js"></script>
<!--
`codeset-component`
Code set management component

@demo demo/index.html
-->

<dom-module id="codeset-component">
    <template>
        <style>
            :host {
                display: block;
            }

            paper-dialog.editor{
                width: 450px;
                overflow: auto;
            }

        </style>
        <app-header-layout fixed fullbleed>
            <app-toolbar>
                <div main-title>Code Set Management</div>
                <paper-icon-button icon="add" on-tap="_openAdd"></paper-icon-button>
            </app-toolbar>
            <div class="grid">
                <iron-data-table id="codeGrid" items="[[codes]]" selection-enabled>
                    <data-table-column width="90px" flex="0">
                        <template>
                            <div hidden="[[!selected]]">
                                <paper-icon-button icon="clear"></paper-icon-button>
                                <paper-icon-button icon="edit"></paper-icon-button>
                            </div>
                        </template>
                    </data-table-column>
                    <data-table-column name="Set" sort-by="set" filter-by="set">
                        <template>[[item.set]]</template>
                    </data-table-column>
                    <data-table-column name="Code" sort-by="code" filter-by="code">
                        <template>[[item.code]]</template>
                    </data-table-column>
                </iron-data-table>
            </div>
        </app-header-layout>


        <paper-dialog id="editorDialog" class="editor"  modal>
            <codeset-component-edit id="editor" on-save="_saveEdit" on-cancel="_cancelEdit" code="{{code}}"></codeset-component-edit>
        </paper-dialog>

    </template>

    <script>
        Polymer({

            is: 'codeset-component',

            properties: {
                api: {
                    type: String
                },
                token:{
                    type: String
                },
                codes:{
                    type: Array,
                    value:[]
                },
            },
            code:{},
            _openAdd: function(){
                this.code = {set:"ZING", id:"ZONK", values: [{attr:"ONE", value:"1"},{attr:"TWO", value:"2"}]};
                this.$.editorDialog.open();
            },
            _openEdit: function(){
                this.$.editorDialog.open();
            },
            _saveEdit: function(e){
                this.$.editorDialog.close();
                this.push('codes', e.detail);
                this.$.codeGrid.size = this.codes.length;
            },
            _cancelEdit: function(){
                this.$.editorDialog.close();
            },
            _getData: function(err, r){
                if(!err){
                    //this.push("codes", r);
                    this.$.codeGrid.size = this.codes.length;
                    this.codes = r;
                }
            },
            ready:function(){
                this.service = new ServiceInterface(this.api);
                this.service.getData(this._getData.bind(this));
            }
        });
    </script>
</dom-module>